<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="emp">
	<select id="selectAll" resultType="map">
		SELECT * FROM emp ORDER BY emp_id DESC
	</select>

	<select id="search1" resultType="map">
		<!-- 
			검색조건에 따라 서로다른 컬럼을 통해 조건식을 작성하는 경우 ${value}를 사용
			
			#{value} : 일반 데이터 바인딩시 사용
			${value} : 테이블명, 컬럼명, 예약어 등을 바인딩시 사용
		-->
		SELECT * FROM emp WHERE ${searchType} LIKE '%' || #{searchKeyword} || '%' ORDER BY emp_id DESC
	</select>
	
	<select id="search2" resultType="map">
		SELECT * 
		FROM (
			SELECT e.*, DECODE(SUBSTR(emp_no,8,1), '1', '남', '3', '남', '여') gender
			FROM emp e
		)
		<!-- where 태그는 몸통부분이 비어있다면 where 키워드를 제거하고 where 내부에 and또는 or로 시작하는 코드가 있으면 이를 제거 -->
		<where>
			<if test="searchType != null and searchType != ''">
				${searchType} LIKE '%' || #{searchKeyword} || '%'
			</if>
			<if test="gender != null and gender != ''">
				AND gender = #{gender}
			</if>
			<if test="salary != null and salary != 0">
				<if test="salaryCompare != null and salaryCompare != ''">			
					<choose>
						<when test="salaryCompare == 'ge'">
							AND salary >= #{salary}
						</when>
						<otherwise>
							<!-- xml의 entity 문자를 이스케이핑할 때 <![CDATA[]]> 사용 -->
							AND salary <![CDATA[<=]]> #{salary}
						</otherwise>
					</choose>			
				</if>
			</if>
			<if test="hire_date != null and hire_date != ''">
				<if test="hiredateCompare != null and hiredateCompare != ''">
					<choose>
						<when test="hiredateCompare.equals('ge')">
							AND hire_date >= #{hire_date}					
						</when>
						<otherwise>
							<!-- xml의 entity 문자를 이스케이핑할 때 <![CDATA[]]> 사용 -->
							AND hire_date <![CDATA[<=]]> #{hire_date}
						</otherwise>
					</choose>
				</if>
			</if>
		</where>
	</select>
	
	<select id="selectJobList" resultType="map">
		SELECT job_code, job_name FROM job
	</select>
	
	<!-- 컬렉션(배열) 형태의 데이터 바인딩 -->
	<select id="search3" resultType="map">
		SELECT * 
		FROM emp e 
		LEFT JOIN dept d ON (e.dept_code = d.dept_id)
		LEFT JOIN job j ON (e.job_code = j.job_code)
		<where>
			<if test="arr != null">
				e.job_code IN
				<foreach item="jobcode" collection="arr" separator="," open="(" close=")">
					#{jobcode}
				</foreach>
			</if>
		</where>
		ORDER BY e.emp_id
	</select>
</mapper>